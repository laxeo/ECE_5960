<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>ECE 5960 LAB 1</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version1)-->
        <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">Tongqing Zhang</span>
                
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html">MainPage</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab1">LAB 1</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab2.html">LAB 2</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab3.html">LAB 3</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab4.html">LAB 4</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab5.html">LAB 5</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab6.html">LAB 6</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab7.html">LAB 7</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab8.html">LAB 8</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab9.html">LAB 9</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab10.html">LAB 10</a></li>
                    <li class="nav-item"><a class="nav-link" href="lab11.html">LAB 11</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container-fluid p-0">
            <!-- lab1-->
            <section class="resume-section" id="lab1">
                <div class="resume-section-content">
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-4"><h2 class="mb-2">LAB 1 - The Artemis Board</h2>
                    <div class="flex-shrink-0"><span class="text-primary2" >Jan 27<sup>th</sup>, 2022</span></div>
                    </div>
                    
                    <div class="flex-grow-1">
                        <h3 class="mb-1">Blink it Up</h3>
                        <div class="subheading mb-2">Make the LED blink</div>
                        <p>In this part, I set the delay between turn the LED on and off to be 100ms. Thus the delay for a whole loop is 200ms, and the blink frequency is 5Hz.</p>
                        <iframe width="640" height="360" src="https://www.youtube.com/embed/g0jb9n1CThM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    
                    <div class="flex-grow-1">
                        <h3 class="mb-1">Serial</h3>
                        <div class="subheading mb-2">Read and Write</div>
                        <p>In this part, the board is able to read the input I give to it and echo the same output to me through the serial port.</p>
                        <iframe width="640" height="360" src="https://www.youtube.com/embed/LvM3wlLP2lc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>

                    <div class="flex-grow-1">
                        <h3 class="mb-1">AnalogRead</h3>
                        <div class="subheading mb-2">Temp Sensor</div>
                        <p>In this part, the board continuously outputs temperature detected by its temp sensor through the monitoring panel. And we can see the temperature went up when I was heating it using a hair dryer.</p>
                        <iframe width="640" height="360" src="https://www.youtube.com/embed/K7g_Yew2VbA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>

                    <div class="flex-grow-1">
                        <h3 class="mb-1">MicrophoneOutput</h3>
                        <div class="subheading mb-2">PDM</div>
                        <p>In this part, the microphone on the board recorded the voice it recieved, and returned the frequency of the loudest sound source using Fourier Transform. I also tested the frequency of my whistle which is approximately 1200~1700.</p>
                        <iframe width="640" height="360" src="https://www.youtube.com/embed/k89ZKAVQGI0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>

                    <div class="flex-grow-1">
                        <h3 class="mb-1">Whistle Detection</h3>
                        <div class="subheading mb-2">Turn on the LED when you whistle, and off otherwise</div>
                        <p>Using the data from the previous step, I know the frequency of my whistle is about 1200~1700. I first initialized digital pin LED_BUILTIN as an output by adding 'pinMode(LED_BUILTIN, OUTPUT);' to void setup( ).
                        Then I added a judgment statement to make the LED turn on when it encounters a sound whose frequency is above 1200, and turn off otherwise.
                        </p>
                        <iframe width="640" height="360" src="https://www.youtube.com/embed/WzCsa4H3_xQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>


                    <div class="flex-grow-1">
                        <h3 class="mb-1">Code Appendix</h3>
                        <div class="subheading mb-2">Modified from Example</div>
                        <pre>
                            <code>
                                <span style="color:red;">int stage = 0;</span>

                                void setup()
                                {
                                <span style="color:red;">// initialize digital pin LED_BUILTIN as an output.
                                pinMode(LED_BUILTIN, OUTPUT);</span>
                                
                                Serial.begin(115200);
                                Serial.println("SparkFun PDM Example");

                                if (myPDM.begin() == false) // Turn on PDM with default settings, start interrupts
                                {
                                    Serial.println("PDM Init failed. Are you sure these pins are PDM capable?");
                                    while (1)
                                    ;
                                }
                                Serial.println("PDM Initialized");

                                printPDMConfig();

                                void loop()
                                {
                                if (myPDM.available())
                                {
                                    myPDM.getData(pdmDataBuffer, pdmDataBufferSize);

                                    printLoudest();
                                }

                                // Go to Deep Sleep until the PDM ISR or other ISR wakes us.
                                am_hal_sysctrl_sleep(AM_HAL_SYSCTRL_SLEEP_DEEP);
                                }

                                //*****************************************************************************
                                //
                                // Analyze and print frequency data.
                                //
                                //*****************************************************************************
                                void printLoudest(void)
                                {
                                float fMaxValue;
                                uint32_t ui32MaxIndex;
                                int16_t *pi16PDMData = (int16_t *)pdmDataBuffer;
                                uint32_t ui32LoudestFrequency;

                                //
                                // Convert the PDM samples to floats, and arrange them in the format
                                // required by the FFT function.
                                //
                                for (uint32_t i = 0; i < pdmDataBufferSize; i++)
                                {
                                    if (PRINT_PDM_DATA)
                                    {
                                    Serial.printf("%d\n", pi16PDMData[i]);
                                    }

                                    g_fPDMTimeDomain[2 * i] = pi16PDMData[i] / 1.0;
                                    g_fPDMTimeDomain[2 * i + 1] = 0.0;
                                }

                                if (PRINT_PDM_DATA)
                                {
                                    Serial.printf("END\n");
                                }

                                //
                                // Perform the FFT.
                                //
                                arm_cfft_radix4_instance_f32 S;
                                arm_cfft_radix4_init_f32(&S, pdmDataBufferSize, 0, 1);
                                arm_cfft_radix4_f32(&S, g_fPDMTimeDomain);
                                arm_cmplx_mag_f32(g_fPDMTimeDomain, g_fPDMMagnitudes, pdmDataBufferSize);

                                if (PRINT_FFT_DATA)
                                {
                                    for (uint32_t i = 0; i < pdmDataBufferSize / 2; i++)
                                    {
                                    Serial.printf("%f\n", g_fPDMMagnitudes[i]);
                                    }

                                    Serial.printf("END\n");
                                }

                                //
                                // Find the frequency bin with the largest magnitude.
                                //
                                arm_max_f32(g_fPDMMagnitudes, pdmDataBufferSize / 2, &fMaxValue, &ui32MaxIndex);

                                ui32LoudestFrequency = (sampleFreq * ui32MaxIndex) / pdmDataBufferSize;

                                if (PRINT_FFT_DATA)
                                {
                                    Serial.printf("Loudest frequency bin: %d\n", ui32MaxIndex);
                                }
                                
                                <span style="color:red;">//modified
                                if(ui32LoudestFrequency>1200 && stage==0){
                                    digitalWrite(LED_BUILTIN, HIGH);
                                    stage = 1;
                                    }
                                else if(ui32LoudestFrequency<=1200 && stage==1){
                                    digitalWrite(LED_BUILTIN, LOW);
                                    stage = 0;
                                    }</span>

                                Serial.printf("Loudest frequency: %d         \n", ui32LoudestFrequency);

                                }
                                }
                            
                            </code>
                        </pre>
                    </div>
                    
                </div>
            </section>
            <hr class="m-0" />
           
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
